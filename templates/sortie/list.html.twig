{% extends 'base.html.twig' %}

{% block title %}Sortir - Accueil{% endblock %}

{% block body %}
  <main class="container">

    <section class="filters card">
      <h2>Filtrer les sorties</h2>

      <form method="get" class="filters-layout">
        <div class="filters-left">
          <div class="row">
            <label for="campus">Campus</label>
            <select id="campus" name="campus">
              <option value="">-- Tous --</option>
              {% for c in campusOptions %}
                <option value="{{ c.id }}" {% if filters.campus == (c.id ~ '') %}selected{% endif %}>
                  {{ c.name }}
                </option>
              {% endfor %}
            </select>
          </div>

          <div class="row">
            <label for="q">Le nom de la sortie contient</label>
            <input id="q" name="q" type="search" value="{{ filters.q }}" placeholder="search">
          </div>

          <div class="row row-inline">
            <label for="from">Entre</label>
            <input id="from" name="from" type="date" value="{{ filters.from }}">
            <span class="inline-text">et</span>
            <input id="to" name="to" type="date" value="{{ filters.to }}">
          </div>
        </div>

        <div class="filters-middle">
          <label class="check">
            <input type="checkbox" name="mine" {% if filters.mine %}checked{% endif %}>
            Sorties dont je suis l'organisateur/trice
          </label>

          <label class="check">
            <input type="checkbox" name="registered" {% if filters.registered %}checked{% endif %}>
            Sorties auxquelles je suis inscrit/e
          </label>

          <label class="check">
            <input type="checkbox" name="not_registered" {% if filters.not_registered %}checked{% endif %}>
            Sorties auxquelles je ne suis pas inscrit/e
          </label>

          <label class="check">
            <input type="checkbox" name="finished" {% if filters.finished %}checked{% endif %}>
            Sorties terminées
          </label>
        </div>

        <div class="filters-right">
          <button class="btn btn--big" type="submit">Rechercher</button>
        </div>
      </form>
    </section>

    <section class="card">
      <div class="table-wrap">
        <table class="table">
          <thead>
          <tr>
            <th>Nom de la sortie</th>
            <th>Date de la sortie</th>
            <th>Clôture</th>
            <th>Inscrits/Places</th>
            <th>État</th>
            <th>Inscrit</th>
            <th>Organisateur</th>
            <th>Actions</th>
          </tr>
          </thead>

          <tbody>
          {% for s in sorties %}
            {% set isIn = app.user and (app.user in s.participants) %}

            <tr>
              <td>{{ s.name }}</td>
              <td>{{ s.dateHeureDebut ? s.dateHeureDebut|date('d/m/Y H:i') : '' }}</td>
              <td>{{ s.dateLimiteInscription ? s.dateLimiteInscription|date('d/m/Y') : '' }}</td>
              <td>{{ s.participants|length }}/{{ s.nbInscriptionMax }}</td>

              {# Etat est une entité : idéalement __toString() dans Etat. Sinon, adapte le champ affiché. #}
              <td>{{ s.etat }}</td>

              <td class="center">{{ isIn ? 'X' : '' }}</td>

              <td>
                {% if s.organisateurSortie %}
                  <a href="{{ path('participant_show', {id: s.organisateurSortie.id}) }}">
                    {{ s.organisateurSortie.pseudo ?? s.organisateurSortie.name ?? 'Organisateur' }}
                  </a>
                {% endif %}
              </td>

              <td>
                <a href="{{ path('sortie_detail', {id: s.id}) }}">Afficher</a>

                {# Tu brancheras ces routes quand tu les auras #}
                {# Exemple :
                {% if isIn %}
                  <a class="action-link" href="{{ path('sortie_desister', {id: s.id}) }}">Se désister</a>
                {% else %}
                  <a class="action-link" href="{{ path('sortie_inscrire', {id: s.id}) }}">S'inscrire</a>
                {% endif %}
                #}
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="8" class="center">Aucune sortie trouvée.</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="create-sortie">
        <a class="btn" href="{{ path('sortie_create') }}">Créer une sortie</a>
      </div>
    </section>

  </main>
{% endblock %}
